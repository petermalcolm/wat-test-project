
<!DOCTYPE HTML>

<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800|Open+Sans+Condensed:300,300italic,700' rel='stylesheet' type='text/css'>
<link href="/styles/game-styles.css" media="screen, projection" rel="stylesheet" type="text/css" />

<!-- Markup -->
<div id="app-wrapper">
    <div id="scoreboard-wrapper"></div>
    <div id="question-wrapper"></div>
    <div id="face-wrapper"></div>
</div>


<!-- Templates -->
<script type="text/html" id="template-employee">
    <article class="employee">
        <img src="{{ url }}" />
        <span class="name hidden">
            <h2>{{ name }}</h2>
        </span>
    </article>
</script>

<script type="text/html" id="template-whois">
    <h1>Who is {{ name }}?</h1>
</script>

<script type="text/html" id="template-scoreboard">
    <div class="row">
        <div class="col-lg-2 col-md-1 scoreboard">
            <p>Two points for right-first-time</p>
            <p>One point for second-guess-correct</p>
            <p>Zero points for third-guess-correct</p>
            <p>Lose one point for fourth-guess-correct</p>
            <p>Lose two points for fifth-guess-correct</p>
            <h2>Your score: {{ value }} </h2>
        </div>
    </div>
</script>

<!-- Libs -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>


<!-- Logic -->
<script>
$(function() {
    _.templateSettings = {
      interpolate: /\{\{(.+?)\}\}/g
    };


    var employeeTemplate = _.template($('#template-employee').html());
    var whoisTemplate = _.template($('#template-whois').html());
    var scoreTemplate = _.template($('#template-scoreboard').html());

    var crntGame, score = { value: 0, pointAvailable: 0 };

    $('#face-wrapper').delegate('.employee', 'click', function() {
        var name = $(this).find('h2').text();

        if (name === crntGame.name) {
            $(this).find('.hidden').removeClass('hidden').addClass('right');
            setTimeout(refresh, 2000);
            score.value += score.pointAvailable;
        } else {
            $(this).find('.hidden').removeClass('hidden').addClass('wrong');
            score.pointAvailable -= 1;
        }
        $('#scoreboard-wrapper').html(scoreTemplate(score));
    });

    var refresh = function() {
        crntGame = false;
        score.pointAvailable = 2;
        var $w = $('#face-wrapper');
        $w.empty();

        $.get('http://api.namegame.willowtreemobile.com').then(function(data) {
            var pool = _.shuffle(data).slice(0,5);
            var selected = _.shuffle(pool).slice(0,1)[0];

            crntGame = selected;
            _.each(pool, function(e) {
                $w.append(employeeTemplate(e))
            });
            $('#question-wrapper').html(whoisTemplate(selected))
        });

        $('#scoreboard-wrapper').html(scoreTemplate(score));
    }

    refresh();

});
</script>
